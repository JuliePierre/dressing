<!-- METATAGS -->
<% content_for :meta_title, "#{@outfit.name}" %>
<% content_for :meta_description, "J'ai besoin de votre aide, je cherche les éléments suivants : #{@missing_items_text}" %>
<% content_for :meta_image, cloudinary_url(@outfit.photos[0].path) %>

<!-- Facebook SDK for JavaScript -->
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1446517282313657',
      xfbml      : true,
      version    : 'v2.9'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<!-- *********** -->

<div class="main">
  <div class="page-title-small bg-grey center-align">
    <div class="container relative">
      <h1><%= @outfit.name %></h1>
      <!-- Nombre de likes -->
      <div id="upvotes-counter-container">
        <%= link_to(upvote_path(@outfit), html_options = { remote: true, method: :post }) do %>
          <% if @user_vote %>
            <i class="fa fa-heart active" aria-hidden="true"></i>
            <span id='upvotes-counter' class="active">
              <%= render 'outfits/upvotes_count', outfit: @outfit %>
            </span>
          <% else %>
            <i class="fa fa-heart" aria-hidden="true"></i>
            <span id='upvotes-counter'>
              <%= render 'outfits/upvotes_count', outfit: @outfit %>
            </span>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="container center-align">
    <!-- Photo de la tenue -->
    <div class="outfit-container">
      <% if @outfit.photos.size != 0 %>
        <% @outfit.photos.each do |photo| %>
          <%= cl_image_tag(photo.path, class: 'outfit-picture') %>
        <% end %>
      <% end %>
    </div>
    <div class="btn highlight-btn" id="add-picture-button">Add pictures</div>
  </div>

  <div id="add-picture-form">
    <div class="container">
      <div class="separation-line"></div>
    </div>
    <div class="container">
      <div class="section-title">
        <h2>Modifier ou ajouter des photos</h2>
      </div>
      <div>
        <%= render 'shared/add_picture_to_outfit', outfit: @outfit %>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="separation-line"></div>
  </div>

  <% if current_user.id == @outfit.user_id %>
    <div class="container">
      <div class="section-title">
        <h2>Ce qu'il me manque</h2>
      </div>
      <div id="missing-items-form">
        <%= render 'shared/missing_items_form', outfit: @outfit %>
      </div>
    </div>
  <% else %>
    <div class="container">
      <div class="section-title">
        <h2>Accessoires recherchés</h2>
      </div>
      <div id="missing-items-display">
        <% @missing_items.each do |item| %>
          <div class="chip chip-large">
            <i class="fa fa-shopping-bag" aria-hidden="true"></i>
            <%= item %>
          </div>
        <% end %>
      </div>

    </div>
    <div class="fb-send" data-href="<%= request.original_url %>">Envoyer un message</div>
  <% end %>

  <div class="container">
    <div class="separation-line"></div>
  </div>


  <div class="container">
    <% if current_user.id == @outfit.user_id %>
      <div class="section-title">
        <h2>Les propositions reçues</h2>
        <% if @outfit.proposals.size == 0 %>
          <p class="center-align">Vous n'avez reçu aucune proposition pour l'instant</p>
        <% else %>
          <% @outfit.proposals.each do |proposal| %>
            <h4>Proposition reçue de <%= User.find(proposal.user_id).email %></h4>
            <p><%= MissingItem.find(proposal.missing_item_id).name %></p>
            <% unless proposal.photos.size == 0 %>
              <% proposal.photos.each do |photo| %>
                <%= cl_image_tag(photo.path, class: 'item-picture') %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>

      </div>
    <% else %>
        <div class="section-title">
        <h2>Ma proposition</h2>
      </div>
      <% if @current_proposals.size != 0 %>
        <p>Je peux prêter : </p>
        <% @current_proposals.each do |proposal| %>
          <div class="chip chip-large">
            <i class="fa fa-shopping-bag" aria-hidden="true"></i>
            <%= MissingItem.find(proposal.missing_item_id).name %>
          </div>
          <% unless proposal.photos.size == 0 %>
            <% proposal.photos.each do |photo| %>
              <%= cl_image_tag(photo.path, class: 'item-picture') %>
            <% end %>
          <% end %>
        <% end %>
      <% else %>
        <div class= "proposal-form" id="new-proposal-form">
          <p>Je te propose : </p>
          <%= render 'shared/new_proposal_form', proposal: @proposal %>
        </div>
      <% end %>
    <% end %>
  </div>


<!-- Créer ici la case review -->

<!--   <div class="container">
    <div class="section-title ">
      <h2>Votre avis</h2>
    </div>
    <div id="outfit_reviews">

    </div>
  </div> -->

  <div class="container center-align">
    <!-- Construire ici un message type qui sera envoyé sur facebook -->
    <!-- Exemple : voici la photo, j'ai besoin de xxx -->
    <!-- 1ère phase : tester d'intégrer l'inbox facebook -->
    <div class="fb-send" data-href="<%= request.original_url %>"></div>
  </div>
</div>
<br>
<br>
<br>


<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).ready(function() {
      $('select').material_select();
    });
    $('#add-picture-button').click(function() {
      $('#add-picture-form').slideDown('slow')
    })
  <% end %>
<% end %>
